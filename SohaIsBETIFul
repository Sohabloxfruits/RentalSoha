-- Load Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()

-- Define Colors for Custom Theme
local defaultColors = {
    SchemeColor = Color3.fromRGB(0, 255, 255),
    Background = Color3.fromRGB(0, 0, 0),
    Header = Color3.fromRGB(0, 0, 0),
    TextColor = Color3.fromRGB(255, 255, 255),
    ElementColor = Color3.fromRGB(20, 20, 20)
}

local colors = defaultColors

-- Create Main UI Window
local Window = Library.CreateLib("Universal Script Hub", colors)

-- Create Tabs
local MainTab = Window:NewTab("Main")
local ESPTab = Window:NewTab("ESP")
local BloxFruitsTab = Window:NewTab("BloxFruits")
local SettingsTab = Window:NewTab("Settings")

-- Create Sections
local MainSection = MainTab:NewSection("Main Features")
local ESPSection = ESPTab:NewSection("ESP Features")
local BloxFruitsSection = BloxFruitsTab:NewSection("BloxFruits Features")
local SettingsSection = SettingsTab:NewSection("Settings")

-- Variables
local mainUIVisible = true
local ESPEnabled = false
local AutoGKEnabled = false
local AutoFarmEnabled = false

-- ESP Feature
local function ToggleESP(state)
    ESPEnabled = state
    if ESPEnabled then
        print("ESP Enabled")
        -- Code for enabling ESP: Highlight players, parts, etc.
    else
        print("ESP Disabled")
        -- Code for disabling ESP
    end
end

ESPSection:NewToggle("Enable ESP", "Highlights all players and parts within range", function(state)
    ToggleESP(state)
end)

-- Function to determine quest giver and NPCs based on player's level
local function GetQuestInfo(level)
    if level < 50 then
        return {
            questGiver = workspace.QuestGivers:FindFirstChild("QuestGiver1"),  -- Change to actual quest giver
            questNPCs = workspace.NPCs:FindFirstChild("NPCGroup1")  -- Change to actual NPC group
        }
    elseif level < 100 then
        return {
            questGiver = workspace.QuestGivers:FindFirstChild("QuestGiver2"),
            questNPCs = workspace.NPCs:FindFirstChild("NPCGroup2")
        }
    else
        return {
            questGiver = workspace.QuestGivers:FindFirstChild("QuestGiver3"),
            questNPCs = workspace.NPCs:FindFirstChild("NPCGroup3")
        }
    end
end

-- AutoFarm Feature with Quest Taking
local function AutoFarm()
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local level = player.Data.Level.Value  -- Replace with actual path to player level
    
    local questInfo = GetQuestInfo(level)
    if not questInfo.questGiver or not questInfo.questNPCs then
        print("Quest giver or NPC group not found for this level.")
        return
    end

    -- Go to the quest giver
    character:MoveTo(questInfo.questGiver.HumanoidRootPart.Position)
    wait(1)

    -- Interact with quest giver to accept quest
    fireproximityprompt(questInfo.questGiver.DialoguePrompt)  -- Replace with actual proximity prompt if needed
    wait(1)

    while AutoFarmEnabled do
        wait(0.5) -- Small delay to prevent overwhelming the game

        -- Go to the quest NPCs
        for _, npc in pairs(questInfo.questNPCs:GetChildren()) do
            if npc:IsA("Model") and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
                character:MoveTo(npc.HumanoidRootPart.Position)
                wait(0.3)  -- Wait briefly for teleport
                keypress(Enum.KeyCode.One) -- Press '1' to equip weapon
                wait(0.1)
                mouse1press() -- Start autoclicking
                wait(0.5)
                mouse1release()
                print("AutoFarm attacking: " .. npc.Name)
            end
        end
    end
end

BloxFruitsSection:NewToggle("Enable AutoFarm", "Accepts quest and auto-attacks NPCs", function(state)
    AutoFarmEnabled = state
    if AutoFarmEnabled then
        AutoFarm()
    else
        print("AutoFarm Disabled")
    end
end)

-- Teleport Tool
local function CreateTeleportTool()
    local tool = Instance.new("Tool")
    tool.RequiresHandle = false
    tool.Name = "TeleportTool"
    tool.Activated:Connect(function()
        local player = game.Players.LocalPlayer
        local mouse = player:GetMouse()
        if mouse.Target then
            local teleportPosition = mouse.Hit.p
            player.Character:MoveTo(teleportPosition)
            print("Teleported to: " .. tostring(teleportPosition))
        end
    end)
    tool.Parent = game.Players.LocalPlayer.Backpack
end

MainSection:NewButton("Equip Teleport Tool", "Click anywhere to teleport", function()
    CreateTeleportTool()
end)

-- Settings Features
SettingsSection:NewLabel("Credits")
SettingsSection:NewLabel("Script by: hamadlla")

SettingsSection:NewLabel("Customize Theme")
SettingsSection:NewColorPicker("Scheme Color", "Change the scheme color", colors.SchemeColor, function(color)
    colors.SchemeColor = color
end)

SettingsSection:NewColorPicker("Background Color", "Change the background color", colors.Background, function(color)
    colors.Background = color
end)

SettingsSection:NewColorPicker("Text Color", "Change the text color", colors.TextColor, function(color)
    colors.TextColor = color
end)

-- UI Toggle Button (Black Square)
local toggleButton = Instance.new("ScreenGui", game.Players.LocalPlayer:WaitForChild("PlayerGui"))
toggleButton.Name = "ToggleUIButton"

local buttonFrame = Instance.new("TextButton", toggleButton)
buttonFrame.Size = UDim2.new(0, 50, 0, 50)
buttonFrame.Position = UDim2.new(0, 10, 0, 10)
buttonFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
buttonFrame.Text = ""
buttonFrame.BorderSizePixel = 0

buttonFrame.MouseButton1Click:Connect(function()
    mainUIVisible = not mainUIVisible
    Library:ToggleUI()
end)

-- Clean-up function to destroy unused UI elements
game.Players.LocalPlayer.PlayerGui.ChildRemoved:Connect(function(child)
    if child.Name == "PartNamesUI" then
        child:Destroy()
    end
end)
